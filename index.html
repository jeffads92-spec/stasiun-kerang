<!-- Ganti bagian <script> di index.html dengan ini -->
<script>
    const API_BASE = '/api';
    const loginForm = document.getElementById('loginForm');
    const alertBox = document.getElementById('alert');
    const loadingBox = document.querySelector('.loading');

    function showAlert(message, type) {
        alertBox.textContent = message;
        alertBox.className = `alert alert-${type}`;
        alertBox.style.display = 'block';
        setTimeout(() => {
            alertBox.style.display = 'none';
        }, 5000);
    }

    function quickLogin(username, password) {
        document.getElementById('username').value = username;
        document.getElementById('password').value = password;
        loginForm.dispatchEvent(new Event('submit'));
    }

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (!username || !password) {
            showAlert('Username dan password harus diisi!', 'error');
            return;
        }

        loadingBox.style.display = 'block';

        try {
            const response = await fetch(`${API_BASE}/auth.php?action=login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
            });

            const result = await response.json();
            
            loadingBox.style.display = 'none';

            if (result.success) {
                // Save user data to localStorage
                localStorage.setItem('user', JSON.stringify({
                    id: result.data.user.id,
                    username: result.data.user.username,
                    full_name: result.data.user.full_name,
                    email: result.data.user.email,
                    role: result.data.user.role,
                    avatar: result.data.user.avatar,
                    session_token: result.data.session_token,
                    loginTime: new Date().toISOString()
                }));
                
                showAlert('Login berhasil! Mengalihkan...', 'success');
                
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1000);
            } else {
                showAlert(result.message || 'Login gagal! Periksa username dan password Anda.', 'error');
            }
        } catch (error) {
            console.error('Login error:', error);
            loadingBox.style.display = 'none';
            showAlert('Terjadi kesalahan saat login. Silakan coba lagi.', 'error');
        }
    });

    // Check if already logged in
    const existingUser = localStorage.getItem('user');
    if (existingUser) {
        // Validate session
        fetch(`${API_BASE}/auth.php?action=check`)
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    window.location.href = 'dashboard.html';
                } else {
                    localStorage.removeItem('user');
                }
            })
            .catch(() => {
                // If check fails, allow login
            });
    }
</script>
