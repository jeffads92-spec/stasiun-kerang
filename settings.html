<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengaturan - Stasiun Kerang</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; }
        .sidebar { width: 260px; background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%); height: 100vh; position: fixed; left: 0; top: 0; overflow-y: auto; }
        .sidebar-header { padding: 25px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header h2 { color: white; font-size: 24px; margin-top: 10px; }
        .logo-icon { font-size: 48px; margin-bottom: 10px; }
        .sidebar-menu { padding: 20px 0; }
        .menu-item { display: flex; align-items: center; padding: 15px 25px; color: rgba(255,255,255,0.8); text-decoration: none; transition: all 0.3s ease; }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: white; padding-left: 30px; }
        .menu-item.active { background: rgba(255,255,255,0.15); border-left: 4px solid #4CAF50; color: white; }
        .menu-item i { font-size: 18px; width: 30px; }
        .main-content { margin-left: 260px; width: calc(100% - 260px); min-height: 100vh; }
        .topbar { background: white; padding: 20px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .topbar h1 { font-size: 28px; color: #333; }
        .content { padding: 30px; }
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .settings-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .card-header { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0; }
        .card-header h2 { font-size: 20px; color: #333; margin-bottom: 5px; }
        .card-header p { color: #999; font-size: 13px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #555; font-weight: 600; font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; }
        .toggle-switch { position: relative; display: inline-block; width: 60px; height: 30px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 30px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #1dd1a1; }
        input:checked + .slider:before { transform: translateX(30px); }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 12px; }
        .setting-info h4 { font-size: 15px; color: #333; margin-bottom: 3px; }
        .setting-info p { font-size: 12px; color: #999; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .info-box { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; margin-bottom: 15px; }
        .info-box h4 { color: #333; margin-bottom: 5px; font-size: 14px; }
        .info-box p { color: #666; font-size: 13px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo-icon">ü¶ê</div>
            <h2>Stasiun Kerang</h2>
        </div>
        <nav class="sidebar-menu">
            <a href="dashboard.html" class="menu-item"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
            <a href="orders.html" class="menu-item"><i class="fas fa-shopping-cart"></i><span>Orders</span></a>
            <a href="menu-management.html" class="menu-item"><i class="fas fa-utensils"></i><span>Menu</span></a>
            <a href="kitchen.html" class="menu-item"><i class="fas fa-fire"></i><span>Kitchen</span></a>
            <a href="reports.html" class="menu-item"><i class="fas fa-chart-line"></i><span>Laporan</span></a>
            <a href="settings.html" class="menu-item active"><i class="fas fa-cog"></i><span>Pengaturan</span></a>
            <a href="#" class="menu-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
        </nav>
    </div>

    <div class="main-content">
        <div class="topbar"><h1>Pengaturan Sistem</h1></div>
        <div class="content">
            <div class="settings-grid">
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-store"></i> Restoran</h2>
                        <p>Informasi restoran Anda</p>
                    </div>
                    <div class="form-group">
                        <label>Nama Restoran</label>
                        <input type="text" id="restaurantName" value="Stasiun Kerang">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="restaurantEmail" value="info@stasiun-kerang.com">
                    </div>
                    <div class="form-group">
                        <label>Telepon</label>
                        <input type="tel" id="restaurantPhone" value="+62 21 1234567">
                    </div>
                    <button class="btn btn-primary" onclick="saveRestaurantSettings()"><i class="fas fa-save"></i> Simpan</button>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-receipt"></i> Pajak & Biaya</h2>
                        <p>Konfigurasi pajak dan biaya</p>
                    </div>
                    <div class="form-group">
                        <label>Pajak (PB1) %</label>
                        <input type="number" id="taxRate" value="10" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Biaya Layanan %</label>
                        <input type="number" id="serviceCharge" value="5" step="0.1">
                    </div>
                    <button class="btn btn-primary" onclick="saveTaxSettings()"><i class="fas fa-save"></i> Simpan</button>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-credit-card"></i> Pembayaran</h2>
                        <p>Metode pembayaran</p>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><h4>Tunai (Cash)</h4></div>
                        <label class="toggle-switch"><input type="checkbox" id="paymentCash" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><h4>Kartu Debit/Kredit</h4></div>
                        <label class="toggle-switch"><input type="checkbox" id="paymentCard" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><h4>QR Code (QRIS)</h4></div>
                        <label class="toggle-switch"><input type="checkbox" id="paymentQR" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><h4>Transfer Bank</h4></div>
                        <label class="toggle-switch"><input type="checkbox" id="paymentTransfer" checked><span class="slider"></span></label>
                    </div>
                    <button class="btn btn-primary" onclick="savePaymentMethods()"><i class="fas fa-save"></i> Simpan</button>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-bell"></i> Notifikasi</h2>
                        <p>Kelola notifikasi</p>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><h4>Order Baru</h4><p>Notif order baru</p></div>
                        <label class="toggle-switch"><input type="checkbox" id="notifNewOrder" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><h4>Stok Rendah</h4><p>Peringatan stok</p></div>
                        <label class="toggle-switch"><input type="checkbox" id="notifLowStock" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><h4>Sound Effect</h4><p>Suara notifikasi</p></div>
                        <label class="toggle-switch"><input type="checkbox" id="notifSound" checked><span class="slider"></span></label>
                    </div>
                    <button class="btn btn-primary" onclick="saveNotificationSettings()"><i class="fas fa-save"></i> Simpan</button>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-database"></i> Database</h2>
                        <p>Informasi koneksi</p>
                    </div>
                    <div class="info-box"><h4>Host</h4><p id="dbHost">mysql.railway.internal</p></div>
                    <div class="info-box"><h4>Database</h4><p id="dbName">railway</p></div>
                    <div class="info-box"><h4>Username</h4><p id="dbUser">root</p></div>
                    <div class="info-box"><h4>Status</h4><p id="dbStatus" style="color: #1dd1a1;">‚úì Terhubung</p></div>
                    <button class="btn btn-primary" onclick="testDatabaseConnection()"><i class="fas fa-sync"></i> Test Koneksi</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) window.location.href = 'index.html';
        const API_BASE = '/api';

        async function fetchSettings() {
            try {
                const response = await fetch(`${API_BASE}/settings.php`);
                const result = await response.json();
                if (result.success && result.data.settings) {
                    const settings = result.data.settings;
                    if (settings.restaurant_name) document.getElementById('restaurantName').value = settings.restaurant_name.value;
                    if (settings.restaurant_email) document.getElementById('restaurantEmail').value = settings.restaurant_email.value;
                    if (settings.restaurant_phone) document.getElementById('restaurantPhone').value = settings.restaurant_phone.value;
                    if (settings.tax_rate) document.getElementById('taxRate').value = parseFloat(settings.tax_rate.value) * 100;
                    if (settings.service_charge) document.getElementById('serviceCharge').value = parseFloat(settings.service_charge.value) * 100;
                }
            } catch (error) { console.error('Error:', error); }
        }

        async function saveRestaurantSettings() {
            const data = {
                restaurant_name: document.getElementById('restaurantName').value,
                restaurant_email: document.getElementById('restaurantEmail').value,
                restaurant_phone: document.getElementById('restaurantPhone').value
            };
            try {
                for (const [key, value] of Object.entries(data)) {
                    await saveSetting(key, value, 'string');
                }
                alert('Pengaturan restoran berhasil disimpan!');
            } catch (error) { alert('Gagal menyimpan'); }
        }

        async function saveTaxSettings() {
            const data = {
                tax_rate: (parseFloat(document.getElementById('taxRate').value) / 100).toString(),
                service_charge: (parseFloat(document.getElementById('serviceCharge').value) / 100).toString()
            };
            try {
                for (const [key, value] of Object.entries(data)) {
                    await saveSetting(key, value, 'decimal');
                }
                alert('Pengaturan pajak berhasil disimpan!');
            } catch (error) { alert('Gagal menyimpan'); }
        }

        async function savePaymentMethods() {
            const data = {
                payment_cash: document.getElementById('paymentCash').checked.toString(),
                payment_card: document.getElementById('paymentCard').checked.toString(),
                payment_qr: document.getElementById('paymentQR').checked.toString(),
                payment_transfer: document.getElementById('paymentTransfer').checked.toString()
            };
            try {
                for (const [key, value] of Object.entries(data)) {
                    await saveSetting(key, value, 'boolean');
                }
                alert('Metode pembayaran berhasil disimpan!');
            } catch (error) { alert('Gagal menyimpan'); }
        }

        async function saveNotificationSettings() {
            const data = {
                notif_new_order: document.getElementById('notifNewOrder').checked.toString(),
                notif_low_stock: document.getElementById('notifLowStock').checked.toString(),
                notif_sound: document.getElementById('notifSound').checked.toString()
            };
            try {
                for (const [key, value] of Object.entries(data)) {
                    await saveSetting(key, value, 'boolean');
                }
                alert('Pengaturan notifikasi berhasil disimpan!');
            } catch (error) { alert('Gagal menyimpan'); }
        }

        async function saveSetting(key, value, type) {
            const response = await fetch(`${API_BASE}/settings.php`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ key, value, type })
            });
            const result = await response.json();
            if (!result.success) throw new Error(result.message);
        }

        async function testDatabaseConnection() {
            try {
                const response = await fetch(`${API_BASE}/settings.php?action=test_db`);
                const result = await response.json();
                if (result.success) {
                    document.getElementById('dbStatus').style.color = '#1dd1a1';
                    document.getElementById('dbStatus').textContent = '‚úì Koneksi berhasil!';
                    alert('‚úì Koneksi database berhasil!');
                } else {
                    document.getElementById('dbStatus').style.color = '#ff6b6b';
                    document.getElementById('dbStatus').textContent = '‚úó Koneksi gagal';
                    alert('‚úó Koneksi database gagal');
                }
            } catch (error) { alert('‚úó Gagal menguji koneksi'); }
        }

        function logout() { if (confirm('Logout?')) { localStorage.removeItem('user'); window.location.href = 'index.html'; } }

        fetchSettings();
    </script>
</body>
</html>
